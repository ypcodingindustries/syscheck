#!/bin/bash
DATA=$(python3 ~/syscheck-project/syscheck-engine)
if [ -z "$DATA" ]; then echo "Engine Error"; exit 1; fi

IFS="|" read -r MU MT DP QS QP UPT V4 V6 TIP TP VPN RX TX RU RT LS LSP HV LL AG CD HD SD SSHJ RECJ JITS JITJ <<< "$DATA"

B='\033[1;34m'; Y='\033[1;33m'; R='\033[0;31m'; G='\033[0;32m'; NC='\033[0m'

get_bar() {
    local val=${1%.*}
    local fill=$(( val * 15 / 100 ))
    if [ "$val" -gt 0 ] && [ "$fill" -eq 0 ]; then fill=1; fi
    local bar=""
    for ((i=0; i<15; i++)); do [ $i -lt $fill ] && bar+="â–ˆ" || bar+=" "; done
    echo -e "${B}${bar}${NC}"
}

status_color() {
    if [[ "$1" =~ ^[23] ]] || [[ "$1" == "active" ]] || [[ "$1" == *"Users"* ]]; then
        echo -e "${G}Online${NC}"
    else
        echo -e "${R}Offline${NC}"
    fi
}

fastfetch
echo "----------------------------------------------------------------"
echo -e " UPTIME:    ${G}${UPT}${NC}"
echo -e " RAM:       [$(get_bar $((MU*100/MT)))] $((MU*100/MT))% ($MU/$MT MB)"
echo -e " DISK:      [$(get_bar $DP)] $DP% ($RU / $RT)"
echo -e " LOGS:      [$(get_bar $LSP)] $LSP% ($LS / 2 GB)"
echo -e " QUOTA:     [$(get_bar $QP)] $QP% ($QS / 750 GB)"
echo "----------------------------------------------------------------"
echo -e " ${R}NETWORK CARNAGE${NC}"
echo "----------------------------------------------------------------"
echo -e " IP V4:     ${B}${V4}${NC}"
echo -e " IP V6:     ${B}${V6}${NC}"
echo -e " TS IP:     ${B}${TIP}${NC}"
echo -e " PEERS:     ${B}${TP} active${NC}"
[[ "$VPN" == "ACTIVE" ]] && VS="${G}${VPN}${NC}" || VS="${R}${VPN}${NC}"
echo -e " VPN:       $VS"
echo -e " SPEED:     ${Y}RX: ${RX}${NC} | ${G}TX: ${TX}${NC}"
echo "----------------------------------------------------------------"
echo -e " ${R}SECURITY & SERVICES${NC}"
echo "----------------------------------------------------------------"
echo -e " HARDEN:    ${Y}${HV}${NC} exposure | LAST: ${B}${LL}${NC}"
echo -e " JAILS:     ${G}${SSHJ}${NC} SSH | ${G}${RECJ}${NC} Recid | ${G}${JITJ}${NC} Jitsi"
echo "----------------------------------------------------------------"
echo -e " ADGUARD:   $(status_color $AG)"
echo -e " CADDY:     $(status_color $CD)"
echo -e " HEDGEDOC:  $(status_color $HD)"
echo -e " SEND:      $(status_color $SD)"
if [[ "$JITS" == *"Users"* ]]; then
    echo -e " JITSI:     ${G}${JITS}${NC}"
else
    echo -e " JITSI:     $(status_color $JITS)"
fi
echo "----------------------------------------------------------------"
